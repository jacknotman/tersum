let _tersum_cloneShadow=function(e){const t=document.createDocumentFragment();return[...e.childNodes].forEach(n=>{n.remove(),t.appendChild(n.cloneNode(!0)),e.appendChild(n)}),t};const _tersum_updateListner=function(e,t,n){let s=e.inner.querySelectorAll(`[_tersus-ref='${t}']`);n.using?s.forEach(s=>{n.using(s,n.value,{obj:e,prop:t})}):s.forEach(s=>{_tersum_update(s,n,{obj:e,prop:t})});let r=new CustomEvent("updated",{detail:{obj:e,prop:t,val:e[t]}});e.outer.dispatchEvent(r)},_tersum_defineVariableHelper=function(){customElements.get("tersum-variablehelper")||window.customElements.define("tersum-variablehelper",class extends HTMLElement{constructor(){super()}})},_tersum_defineTemplate=function(e){window.customElements.define(e,class extends HTMLElement{constructor(){super()}connectedCallback(){var e=new Event("connected");this.dispatchEvent(e)}disconnectedCallback(){var e=new Event("disconnected");this.dispatchEvent(e)}})},_tersum_define=function(e){var t;customElements.get("tersum-variablehelper")||window.customElements.define("tersum-variablehelper",class extends HTMLElement{constructor(){super()}}),this.data=e,this.data.elementName?this.data.elementName=this.data.elementName.toLowerCase()+"-tersum":console.error("A custom element name must be defined"),this.data.template||console.error("Tersus","A template must be defined"),t=this.data.elementName,window.customElements.define(t,class extends HTMLElement{constructor(){super()}connectedCallback(){var e=new Event("connected");this.dispatchEvent(e)}disconnectedCallback(){var e=new Event("disconnected");this.dispatchEvent(e)}}),this.UpdateListener=_tersum_updateListner,this.registry=[]},_tersum_constructor=function(e,t){if(this.elementName=e.data.elementName,this.template=e.data.template,this.outer=document.createElement(this.elementName),this.inner=this.outer.attachShadow({mode:"open"}),e.data.globalAttributes)for(const[t,n]of Object.entries(e.data.globalAttributes))this.outer.setAttribute(`${t}`,`${n}`);if(e.data.styles){const t=document.createElement("style");t.textContent=e.data.styles,this.inner.appendChild(t)}if(t.attributes)for(const[e,n]of Object.entries(t.attributes))this.outer.setAttribute(`${e}`,`${n}`);let n,s=new RegExp(/{-(.*?)-}/g),r=[];do{if(n=s.exec(this.template)){r.push(n[0]);let e=n[0],t=e.replace(/^{-|\-}$/gm,""),s=document.createElement("tersum-variablehelper");s.setAttribute("_tersus-ref",`${t}`),this.template=this.template.replace(e,s.outerHTML),this[t]=null}}while(n);if(this.inner.innerHTML+=this.template,t.variables)for(const[n,s]of Object.entries(t.variables))n in this?e.UpdateListener(this,n,s):console.error(`Supplied variable '${n}' does not exist in element '${this.elementName}'`)},_tersum_handler=function(e){return{get:(e,t,n)=>t in e?e[t]:void 0,set:(t,n,s)=>n in t?(e.UpdateListener(t,n,s),!0):(console.error(`Supplied variable '${n}' does not exist in element '${t.elementName}'`),!0)}},_tersum_create=function(e,t){this.constructor=new _tersum_constructor(e,t),this.handler=_tersum_handler(e);let n=new Proxy(this.constructor,this.handler);return e.registry.push(n),n},_tersum_update=function(e,t,n){return new Promise((s,r)=>{let a=n.obj,i=n.prop;if(t instanceof _tersum_constructor){let n=t.outer.cloneNode(!1);n.attachShadow({mode:"open"}).appendChild(_tersum_cloneShadow(t.inner)),a[i]=n,e.textContent="",e.appendChild(a[i]),s(!0)}else if(t instanceof HTMLElement){let n=t.cloneNode(!0);a[i]=n,e.textContent="",e.appendChild(a[i]),s(!0)}else a[i]=t,e.innerHTML=a[i],s(!0);s(!1)})},Tersum={Define:_tersum_define,Create:_tersum_create,Update:_tersum_update};
